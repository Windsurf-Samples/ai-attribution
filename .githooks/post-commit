#!/bin/sh

# Get commit info
COMMIT_HASH=$(git rev-parse HEAD)

# Create commit log directory
COMMIT_DIR="$(git rev-parse --show-toplevel)/commit_logs/${COMMIT_HASH}"
mkdir -p "$COMMIT_DIR"

# Run stats collection and OTEL export in background
HOOK_DIR="$(dirname "$0")"
(
  sleep 5  # Wait for git-ai to finish processing
  git-ai stats "$COMMIT_HASH" --json > "$COMMIT_DIR/stats.json"
  "$HOOK_DIR/otel-export.sh" "$COMMIT_HASH"
) &

echo "Commit logged to $COMMIT_DIR/"
